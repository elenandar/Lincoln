/*
Module: Context â€” Lincoln v17.0.0-phase1
Contract:
- Phase 1: Infrastructure Layer Implementation
- Checks for command execution flag and halts AI generation
- Minimal context processing
- Future phases will inject character info and world state
*/

// === CONTEXT MODIFIER v17.0.0-phase1 ===
const __SCRIPT_SLOT__ = "Context";

const modifier = function(text) {
  // Safe text handling
  var raw = String(text || "");
  
  // Check if LC is available
  if (typeof LC === "undefined") {
    return { text: raw };
  }
  
  // Initialize for this slot
  var L = LC.lcInit(__SCRIPT_SLOT__);
  
  // Check if a command was executed in Input
  // If so, halt AI generation with stop:true
  // (Context is the only place where stop:true is honored)
  if (state.lincoln && state.lincoln._commandExecuted) {
    state.lincoln._commandExecuted = false;
    state.lincoln.stateVersion++;
    return { text: "", stop: true };
  }
  
  // Pass through for Phase 1
  // In future phases, this will handle context overlay,
  // character information injection, and world state
  return { text: raw };
};

// Execute modifier and return result
return modifier(text);
