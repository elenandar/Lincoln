/*
Module: Output â€” Lincoln v17.0.0-phase1
Contract:
- Phase 1: Infrastructure Layer Implementation
- Handles message queue (LC.Drafts) integration
- Prepends queued messages to AI output
- Clears action type after output
*/

// === OUTPUT MODIFIER v17.0.0-phase1 ===
const __SCRIPT_SLOT__ = "Output";

const modifier = function(text) {
  // Safe text handling
  var raw = String(text || "");
  
  // Check if LC is available
  if (typeof LC === "undefined") {
    return { text: raw };
  }
  
  // Initialize for this slot
  var L = LC.lcInit(__SCRIPT_SLOT__);
  
  // Process drafts queue if available
  var output = raw;
  if (LC.Drafts) {
    var queuedMessages = LC.Drafts.flush("\n");
    if (queuedMessages) {
      output = queuedMessages + (raw ? "\n" + raw : "");
    }
  }
  
  // Clear action type after output is processed
  if (LC.currentAction) {
    LC.currentAction.clear();
  }
  
  return { text: output };
};

// Execute modifier and return result
return modifier(text);
