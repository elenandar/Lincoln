// ═══════════════════════════════════════════════════════════════════════════
// LINCOLN v17.0.0 - OUTPUT SCRIPT
// ═══════════════════════════════════════════════════════════════════════════
// This script processes AI output before it's shown to the player.
// Executed after Library.txt loads and AI generates response.
// CRITICAL: Never use stop:true in Output script!
// ═══════════════════════════════════════════════════════════════════════════

var modifier = function(text) {
  try {
    // ────────────────────────────────────────────────────────────────────────
    // 1. COMMAND OUTPUT INTERCEPTION
    // ────────────────────────────────────────────────────────────────────────
    if (state.lincoln && state.lincoln.commandOutput) {
      var out = state.lincoln.commandOutput;
      delete state.lincoln.commandOutput;
      if (out === "" || out == null) {
        out = " ";
      }
      return { text: "\n[SYS] " + out };
    }
    
    // ────────────────────────────────────────────────────────────────────────
    // 2. OUTPUT PROCESSING
    // ────────────────────────────────────────────────────────────────────────
    // Phase-0: No output modifications yet
    // Future phases will add:
    // - Event extraction and qualia updates
    // - Relationship changes detection
    // - Story Cards updates
    // - Turn counter increment
    
    // ────────────────────────────────────────────────────────────────────────
    // 3. ENSURE VALID RETURN
    // ────────────────────────────────────────────────────────────────────────
    // CRITICAL: Never return empty string from Output
    // CRITICAL: Never use stop:true in Output
    
    if (!text || text === "") {
      return { text: " " };
    }
    
    return { text: text };
  } catch (e) {
    console.log("Output error:", e);
    return { text: text || " " };
  }
};

modifier(text);
