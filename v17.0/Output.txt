// === PROJECT LINCOLN v17 - OUTPUT ===
// Version: 17.0.4 (Phase 1 Final Hotfix)

const modifier = (text) => {
  const LC = state.shared.LC;
  if (typeof LC === 'undefined') {
    return { text };
  }

  const L = LC.lcInit('Output');
  let outputText = LC.Tools.toStr(text);

  if (L.currentAction.type === 'story') {
    LC.Turns.inc();
  }

  const messages = LC.consumeMsgs();
  if (messages.length > 0) {
    const sysBlock = messages.map(m => m.text).join('\n');
    outputText = sysBlock + '\n\n' + outputText;
  }

  return { text: outputText };
};

return modifier(text);
